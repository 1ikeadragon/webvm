FROM --platform=i386 i386/debian:buster
ARG DEBIAN_FRONTEND=noninteractive

# Install prerequisites
RUN apt-get update && apt-get -y upgrade && \
    apt-get install -y \
    ca-certificates \
    curl \
    iptables \
    kmod

# Download and install Docker binary
RUN curl -fsSL https://download.docker.com/linux/static/stable/i386/docker-20.10.9.tgz -o docker.tgz && \
    tar xzvf docker.tgz && \
    mv docker/* /usr/bin/ && \
    rm -rf docker docker.tgz

# Set up Docker daemon directory
RUN mkdir -p /var/lib/docker

# Create user and set password
RUN useradd -m user && echo "user:password" | chpasswd
RUN usermod -aG docker user
RUN echo 'root:password' | chpasswd

CMD [ "/bin/bash" ]
